class LangMapping < <%= ActiveRecord::Migration.current_version.to_f > 5 ? ApplicationRecord : ActiveRecord::Base %>
  belongs_to :kclass, polymorphic: true

  class << self
    def get_lang_field(obj, field)
      return obj.attributes[field.to_s] if Current.user_lang == 'zh-cn'
      get_lang_mapping(obj, field)
    end

    def get_lang_mapping(obj, field)
      lang_cache = Rails.cache.fetch("#{obj.class}_#{obj.id}_#{field}_#{Current.user_lang}") do
        lang_mapping_field = obj.lang_mappings.find_by(field: field.to_s)
        lang_mapping_field.send("#{I18n.locale}".downcase) if lang_mapping_field
      end
      return obj.attributes[field.to_s] if lang_cache.blank?
      lang_cache
    end
  end
end